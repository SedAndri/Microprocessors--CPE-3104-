;BORDARIO SID ANDRE P


ISR1 SEGMENT 'CODE'
ON_OFF PROC FAR
ASSUME CS:ISR1, DS:DATA
ORG 00000H
   PUSHF
   PUSH AX
   PUSH DX
   PUSH DI          
   CMP ON_FLAG, 1
   JE RESET_ON
   MOV ON_FLAG, 1
   MOV MODE_FLAG, 1
   JMP EXIT_ON_OFF
   RESET_ON:
      MOV ON_FLAG, 0
      MOV PAUSE_FLAG, 0
   EXIT_ON_OFF:
   POP DI           
   POP DX
   POP AX
   POPF
   IRET
ON_OFF ENDP
ISR1 ENDS

ISR2 SEGMENT 'CODE'
PAUSE_PLAY PROC FAR
ASSUME CS:ISR2, DS:DATA
ORG 00050H
   PUSHF
   PUSH AX
   PUSH DX
   PUSH DI
   
   CMP ON_FLAG, 1
   JNE EXIT_PAUSE_PLAY    
   

   CMP PASS_DONE, 1
   JNE TOGGLE_PAUSE      
   

   MOV AL, 11111111B
   OUT PORTC, AL
   MOV PASS_DONE, 0      
   JMP EXIT_PAUSE_PLAY
   
TOGGLE_PAUSE:
   CMP PAUSE_FLAG, 1
   JE RESET_PAUSE
   MOV PAUSE_FLAG, 1
   JMP EXIT_PAUSE_PLAY
   
RESET_PAUSE:
   MOV PAUSE_FLAG, 0

EXIT_PAUSE_PLAY:
   POP DI
   POP DX
   POP AX
   POPF
   IRET
PAUSE_PLAY ENDP
ISR2 ENDS

ISR3 SEGMENT 'CODE'
MODES PROC FAR
ASSUME CS:ISR3, DS:DATA
ORG 00100H
   PUSHF
   PUSH AX
   PUSH DX

   PUSH DS
   MOV AX, DATA
   MOV DS, AX

   MOV MODE_FLAG, 2         
   MOV PAUSE_FLAG, 0


   MOV AL, 00000000B
   OUT PORTC, AL


   MOV AL, 00000000B
   OUT PORTA, AL
   OUT PORTB, AL


   MOV AL, 20H
   OUT PIC1, AL

   POP DS
   POP DX
   POP AX
   POPF
   IRET
MODES ENDP
ISR3 ENDS

DATA SEGMENT
ORG 00250H
   PORTA EQU 0F0H	
   PORTB EQU 0F2H
   PORTC EQU 0F4H
   COM_REG1 EQU 0F6H
   PIC1 EQU 0E0H	
   PIC2 EQU 0E2H
   ICW1 EQU 013H
   ICW2 EQU 080H      
   ICW4 EQU 003H
   OCW1 EQU 0F8H     
   ON_FLAG DB 0
   PAUSE_FLAG DB 0
   MODE_FLAG DB 1
   TEMP DB ?
   PASS_DONE DB 0
DATA ENDS

STK SEGMENT STACK
   BOS DW 64d DUP (?)
   TOS LABEL WORD
STK ENDS

CODE    SEGMENT PUBLIC 'CODE'
        ASSUME CS:CODE, DS:DATA, SS:STK
    ORG 00300H
START:
   MOV AX, 0
   MOV ES, AX           

   MOV AX, DATA
   MOV DS, AX
   MOV AX, STK
   MOV SS, AX
   LEA SP, TOS
   CLI


   MOV AX, OFFSET ON_OFF
   MOV ES:[80H*4], AX      
   MOV AX, SEG ON_OFF
   MOV ES:[80H*4+2], AX    

   MOV AX, OFFSET PAUSE_PLAY
   MOV ES:[81H*4], AX       
   MOV AX, SEG PAUSE_PLAY
   MOV ES:[81H*4+2], AX    

   MOV AX, OFFSET MODES
   MOV ES:[82H*4], AX       
   MOV AX, SEG MODES
   MOV ES:[82H*4+2], AX    


   MOV DX, COM_REG1
   MOV AL, 10000000B
   OUT DX, AL


   MOV AL, ICW1
   OUT PIC1, AL
   MOV AL, ICW2
   OUT PIC2, AL
   MOV AL, ICW4
   OUT PIC2, AL
   MOV AL, OCW1
   OUT PIC2, AL
   STI

HERE:
   CMP MODE_FLAG, 2
   JE STOP                


   MOV AL, 00000000B
   OUT PORTA, AL
   MOV AL, 00000000B
   OUT PORTB, AL

   CMP ON_FLAG, 0
   JE HERE                

   CMP PAUSE_FLAG, 1
   JE PAUSE

   CMP MODE_FLAG, 1
   JE DEFAULT

   JMP HERE
   
   DEFAULT:
      MOV SI, OFFSET GLYPH_S      
      CALL PRINT_CHAR
      CALL PRINT_CHAR              
      MOV SI, OFFSET GLYPH_S_HOLD1 
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_SS     
      CALL PRINT_CHAR
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_SS_HOLD1
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_SSS    
      CALL PRINT_CHAR
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_SSS_HOLD1
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_SSSS   
      CALL PRINT_CHAR
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_SSSS_HOLD
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_S_SPACER
      CALL PRINT_CHAR

      ; P
      MOV SI, OFFSET GLYPH_P
      CALL PRINT_CHAR
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_P_HOLD1
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_PP
      CALL PRINT_CHAR
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_PP_HOLD1
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_PPP
      CALL PRINT_CHAR
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_PPP_HOLD1
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_PPPP
      CALL PRINT_CHAR
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_PPPP_HOLD
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_P_SPACER
      CALL PRINT_CHAR

      ; B
      MOV SI, OFFSET GLYPH_B
      CALL PRINT_CHAR
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_B_HOLD1
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_BB
      CALL PRINT_CHAR
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_BB_HOLD1
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_BBB
      CALL PRINT_CHAR
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_BBB_HOLD1
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_BBBB
      CALL PRINT_CHAR
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_BBBB_HOLD
      CALL PRINT_CHAR
      MOV SI, OFFSET GLYPH_B_SPACER
      CALL PRINT_CHAR
      
      MOV PASS_DONE, 1
      INT 81H                  
      
   JMP HERE
   
   
   STOP:

      MOV AL, 00000000B
      OUT PORTC, AL
      JMP SHOW_X_FOREVER


SHOW_X_FOREVER:
   MOV SI, OFFSET GLYPH_X
   MOV AH, 11111110B        

   ROWX_LOOP:

   CMP MODE_FLAG, 2
   JNE EXIT_SHOW_X


   MOV AL, 00000000B
   OUT PORTA, AL


   MOV AL, AH
   OUT PORTB, AL


   MOV AL, BYTE PTR CS:[SI]
   CALL REV5
   OUT PORTA, AL


   MOV DX, 0020H
HOLDX_TIGHT:
   DEC DX
   JNZ HOLDX_TIGHT


   INC SI
   ROL AH, 1


   CMP SI, OFFSET GLYPH_X + 8
   JB ROWX_LOOP
   MOV SI, OFFSET GLYPH_X
   MOV AH, 11111110B
   JMP ROWX_LOOP

EXIT_SHOW_X:
   MOV AL, 00000000B
   OUT PORTA, AL
   OUT PORTB, AL
   JMP HERE

   PRINT_CHAR:
   MOV DI, SI
   MOV BX, 0030H    ;edit delay for led

   REFRESH_LOOP:
   CMP MODE_FLAG, 2
   JE FORCE_STOP

   MOV AH, 11111110B
   MOV SI, DI
   MOV CL, 8
 
 ROW_LOOP:
   CMP MODE_FLAG, 2
   JE FORCE_STOP

   MOV AL, AH
   OUT PORTB, AL
   MOV AL, BYTE PTR CS:[SI]
   CALL REV5
   OUT PORTA, AL
   MOV DX, 0008H

   HOLD_LOOP:
   NOP
   DEC DX
   JNZ HOLD_LOOP
   INC SI
   ROL AH,1
   DEC CL
   JNZ ROW_LOOP
   DEC BX
   JNZ REFRESH_LOOP
   RET

FORCE_STOP:
      JMP STOP

   PAUSE:
      MOV SI, DI
      MOV AH, 11111110B
   F2:

      CMP MODE_FLAG, 2
      JE FORCE_STOP

      CMP PAUSE_FLAG, 0
      JE UNPAUSE
      MOV AL, AH
      OUT PORTB, AL
      MOV AL, BYTE PTR CS:[SI]    
      CALL REV5                  
      OUT PORTA, AL
      CMP ON_FLAG, 0
      JE HERE
      CALL DELAY_250MS
      MOV AL, 00H
      OUT PORTA, AL
      INC SI
      CLC
      ROL AH, 1
      JC F2
      JMP HERE
UNPAUSE:
      MOV AL, MODE_FLAG
      CMP TEMP, AL
      JNE CHECK_MODE
      RET
      CHECK_MODE:
      CMP MODE_FLAG, 1
      JE DEFAULT
      CMP MODE_FLAG, 2
      JE STOP

OFF:
      MOV AL, 00000000B
      OUT PORTA, AL
      MOV AL, 11111111B
      OUT PORTB, AL
      MOV ON_FLAG, 0
      MOV MODE_FLAG, 1
   JMP HERE

   DELAY_250MS:	MOV CX, 0AFFH ;edit for faster or slower
   TIMER1:
      NOP
      NOP
      NOP
      NOP
      LOOP TIMER1
   RET

   DELAY_500MS:	MOV CX, 03AAH	
   L2:
      NOP
      NOP
      LOOP L2
   RET

   DELAY_1MS: MOV BX, 00AAH
   L1:
      DEC BX
      NOP
      JNZ L1
      RET
   RET


REV5 PROC NEAR
   PUSH CX
   PUSH DX
  AND AL, 00011111B      
   XOR DL, DL
   MOV CL, 5
@@rev:
   SHR AL, 1             
   RCL DL, 1              
   LOOP @@rev
   MOV AL, DL
   POP DX
   POP CX
   RET
REV5 ENDP

GLYPH_SPACE:
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B   

GLYPH_S:
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000000B   

GLYPH_SS:
      DB 00000011B
      DB 00000010B
      DB 00000010B
      DB 00000011B
      DB 00000001B
      DB 00000001B
      DB 00000011B
      DB 00000000B   

GLYPH_SSS:
      DB 00000111B
      DB 00000100B
      DB 00000100B
      DB 00000111B
      DB 00000001B
      DB 00000001B
      DB 00000111B
      DB 00000000B   

GLYPH_SSSS:
      DB 00011110B
      DB 00010000B
      DB 00010000B
      DB 00011110B
      DB 00000010B
      DB 00000010B
      DB 00011110B
      DB 00000000B  

GLYPH_S_SPACER:
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B  

GLYPH_P:
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000000B 

GLYPH_PP:
      DB 00000011B
      DB 00000010B
      DB 00000010B
      DB 00000011B
      DB 00000010B
      DB 00000010B
      DB 00000010B
      DB 00000000B   

GLYPH_PPP:
      DB 00000111B
      DB 00000100B
      DB 00000100B
      DB 00000111B
      DB 00000100B
      DB 00000100B
      DB 00000100B
      DB 00000000B  

GLYPH_PPPP:
      DB 00011110B
      DB 00010010B
      DB 00010010B
      DB 00011110B
      DB 00010000B
      DB 00010000B
      DB 00010000B
      DB 00000000B  

GLYPH_P_SPACER:
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B  

GLYPH_B:
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000000B 

GLYPH_BB:
      DB 00000011B
      DB 00000010B
      DB 00000010B
      DB 00000011B
      DB 00000010B
      DB 00000010B
      DB 00000011B
      DB 00000000B 

GLYPH_BBB:
      DB 00000111B
      DB 00000101B
      DB 00000101B
      DB 00000111B
      DB 00000101B
      DB 00000101B
      DB 00000111B
      DB 00000000B  

GLYPH_BBBB:
      DB 00011110B
      DB 00010010B
      DB 00010010B
      DB 00011110B
      DB 00010010B
      DB 00010010B
      DB 00011110B
      DB 00000000B 

GLYPH_B_SPACER:
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B 

GLYPH_X:
      DB 00010001B
      DB 00001010B
      DB 00000100B
      DB 00001010B
      DB 00010001B
      DB 00010001B
      DB 00000000B
      DB 00000000B  

GLYPH_S_HOLD1:
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000000B 

GLYPH_SS_HOLD1:
      DB 00000011B
      DB 00000010B
      DB 00000010B
      DB 00000011B
      DB 00000001B
      DB 00000001B
      DB 00000011B
      DB 00000000B  

GLYPH_SSS_HOLD1:
      DB 00000111B
      DB 00000100B
      DB 00000100B
      DB 00000111B
      DB 00000001B
      DB 00000001B
      DB 00000111B
      DB 00000000B  

GLYPH_SSSS_HOLD:
      DB 00011110B
      DB 00010000B
      DB 00010000B
      DB 00011110B
      DB 00000010B
      DB 00000010B
      DB 00011110B
      DB 00000000B 

GLYPH_P_HOLD1:
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000000B 

GLYPH_PP_HOLD1:
      DB 00000011B
      DB 00000010B
      DB 00000010B
      DB 00000011B
      DB 00000010B
      DB 00000010B
      DB 00000010B
      DB 00000000B  

GLYPH_PPP_HOLD1:
      DB 00000111B
      DB 00000100B
      DB 00000100B
      DB 00000111B
      DB 00000100B
      DB 00000100B
      DB 00000100B
      DB 00000000B  

GLYPH_PPPP_HOLD:
      DB 00011110B
      DB 00010010B
      DB 00010010B
      DB 00011110B
      DB 00010000B
      DB 00010000B
      DB 00010000B
      DB 00000000B  

GLYPH_B_HOLD1:
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000001B
      DB 00000000B  

GLYPH_BB_HOLD1:
      DB 00000011B
      DB 00000010B
      DB 00000010B
      DB 00000011B
      DB 00000010B
      DB 00000010B
      DB 00000011B
      DB 00000000B  

GLYPH_BBB_HOLD1:
      DB 00000111B
      DB 00000101B
      DB 00000101B
      DB 00000111B
      DB 00000101B
      DB 00000101B
      DB 00000111B
      DB 00000000B  

GLYPH_BBBB_HOLD:
      DB 00011110B
      DB 00010010B
      DB 00010010B
      DB 00011110B
      DB 00010010B
      DB 00010010B
      DB 00011110B
      DB 00000000B  

CODE ENDS
END START