
.MODEL SMALL
.STACK 100H

DATA SEGMENT
PORTA    EQU 0F0H
PORTB    EQU 0F2H
PORTC    EQU 0F4H
SEG_TABLE DB 00111111B,
          00000110B,
          01011011B,
          01001111B,
          01100110B,
          01101101B,
          01111101B,
          00000111B,
          01111111B,
          01101111B
DATA ENDS

CODE SEGMENT
ASSUME CS:CODE, DS:DATA

START:
    MOV AX, DATA
    MOV DS, AX

WAIT_BUTTON:
    IN  AL, PORTC
    TEST AL, 01H
    JZ   WAIT_BUTTON

    IN   AL, PORTC
    MOV  CL, 4
    SHR  AL, CL
    AND  AL, 0FH
    CMP  AL, 9
    JBE  DIP_OK
    MOV  AL, 9
DIP_OK:
    MOV  DL, AL

    MOV  SI, OFFSET SEG_TABLE
    XOR  BX, BX

COUNT_LOOP:
    MOV  AL, BL
    OUT  PORTA, AL

    MOV  AL, [SI + BX]
    OUT  PORTB, AL

    CALL DELAY_1S

    INC  BL
    CMP  BL, DL
    JBE  COUNT_LOOP
    XOR  BL, BL
    JMP  COUNT_LOOP

DELAY_1S PROC
    PUSH BX
    PUSH CX
    MOV  CX, 1000
D1:
    CALL DELAY_1MS
    LOOP D1
    POP  CX
    POP  BX
    RET
DELAY_1S ENDP

DELAY_1MS PROC
    MOV  BX, 02CAH
L1:
    DEC  BX
    NOP
    JNZ  L1
    RET
DELAY_1MS ENDP

CODE ENDS
END START